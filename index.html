<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrÃ¬nh Dá»‹ch Tiáº¿ng ÃŠ-Ä‘Ãª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f0f4f8;
        }
        .card {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .tab-button.active {
            border-color: #2563eb;
            color: #2563eb;
            background-color: #dbeafe;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .dictionary-item:hover {
            background-color: #f9fafb;
            transform: translateX(4px);
        }
        .button-primary {
            background-color: #2563eb; /* blue-600 */
            color: white;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .button-primary:hover {
            background-color: #1d4ed8; /* blue-700 */
            transform: scale(1.05);
        }
        .button-secondary {
            background-color: #f3f4f6; /* gray-100 */
            color: #1f2937; /* gray-900 */
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .button-secondary:hover {
            background-color: #e5e7eb; /* gray-200 */
            transform: scale(1.05);
        }
        .button-danger {
            background-color: #ef4444; /* red-500 */
            color: white;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .button-danger:hover {
            background-color: #dc2626; /* red-600 */
            transform: scale(1.05);
        }
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .message-box.show {
            opacity: 1;
            visibility: visible;
        }
        .record-icon.recording {
            color: red;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Expose Firebase and other key modules to the global window object
        window.firebaseModules = {
            initializeApp,
            auth: { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged },
            firestore: { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs }
        };
    </script>
</head>
<body class="antialiased text-slate-800">

    <div class="min-h-screen p-4 sm:p-6 md:p-8 flex flex-col items-center">
        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-bold text-slate-900">TrÃ¬nh Dá»‹ch Tiáº¿ng ÃŠ-Ä‘Ãª</h1>
            <p class="mt-2 text-lg text-slate-600">Má»™t cÃ´ng cá»¥ hiá»‡n Ä‘áº¡i Ä‘á»ƒ khÃ¡m phÃ¡ ngÃ´n ngá»¯ ÃŠ-Ä‘Ãª</p>
        </header>

        <main class="w-full max-w-4xl mx-auto">
            <div class="card rounded-2xl shadow-lg p-6 md:p-8">
                <p class="mb-6 text-slate-700 text-center">
                    á»¨ng dá»¥ng nÃ y cho phÃ©p báº¡n dá»‹ch vÄƒn báº£n, táº¡o vÃ­ dá»¥, tÃ³m táº¯t ná»™i dung vÃ  tháº­m chÃ­ dá»‹ch tá»« hÃ¬nh áº£nh. Báº¯t Ä‘áº§u báº±ng cÃ¡ch nháº­p vÄƒn báº£n vÃ o Ã´ bÃªn dÆ°á»›i.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex flex-col space-y-4">
                        <label for="inputText" class="font-semibold text-slate-800">VÄƒn báº£n gá»‘c (Viá»‡t hoáº·c ÃŠ-Ä‘Ãª)</label>
                        <div class="relative w-full">
                            <textarea id="inputText" rows="8" class="w-full p-4 rounded-lg border-2 border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300 resize-none" placeholder="Nháº­p vÄƒn báº£n cáº§n dá»‹ch..."></textarea>
                            <button id="recordButton" title="Ghi Ã¢m giá»ng nÃ³i" class="absolute bottom-3 right-3 p-2 rounded-full bg-slate-100 hover:bg-slate-200 transition">
                                <span class="record-icon">ğŸ™ï¸</span>
                            </button>
                        </div>
                    </div>
                    <div class="flex flex-col space-y-4">
                        <label for="outputText" class="font-semibold text-slate-800">Káº¿t quáº£ dá»‹ch</label>
                           <div class="relative w-full">
                                <textarea id="outputText" rows="8" readonly class="w-full p-4 rounded-lg bg-slate-100 border-2 border-slate-200 resize-none" placeholder="Káº¿t quáº£ dá»‹ch sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y..."></textarea>
                                <button id="speakTranslatedTextButton" title="PhÃ¡t Ã¢m vÄƒn báº£n" class="absolute bottom-3 right-3 p-2 rounded-full bg-slate-200 hover:bg-slate-300 transition">
                                    <span>ğŸ”Š</span>
                                </button>
                           </div>
                    </div>
                </div>

                <div class="mt-6 flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button id="translateButton" class="w-full sm:w-auto flex items-center justify-center gap-2 px-8 py-3 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 button-primary">
                        <span class="button-icon">âœ¨</span>
                        <span class="button-text">Dá»‹ch</span>
                    </button>
                    <button id="generateExamplesButton" class="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-orange-500 text-white font-semibold rounded-lg shadow-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-transform transform hover:scale-105">
                        <span class="button-icon">ğŸ’¡</span>
                        <span class="button-text">Táº¡o vÃ­ dá»¥</span>
                    </button>
                    <button id="summarizeExplainButton" class="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg shadow-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-transform transform hover:scale-105">
                        <span class="button-icon">ğŸ“</span>
                        <span class="button-text">TÃ³m táº¯t</span>
                    </button>
                </div>
                   <div id="additionalOutputWrapper" class="mt-6 hidden">
                    <label for="additionalOutput" class="font-semibold text-slate-800">Káº¿t quáº£ bá»• sung</label>
                    <div class="relative w-full mt-2">
                        <textarea id="additionalOutput" rows="4" readonly class="w-full p-4 rounded-lg bg-slate-100 border-2 border-slate-200 resize-none"></textarea>
                        <button id="speakAdditionalTextButton" title="PhÃ¡t Ã¢m vÄƒn báº£n" class="absolute bottom-3 right-3 p-2 rounded-full bg-slate-200 hover:bg-slate-300 transition">
                               <span>ğŸ”Š</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Generate Paragraph Section -->
            <div class="card rounded-2xl shadow-lg p-6 md:p-8 mt-10">
                <h2 class="text-2xl font-bold text-slate-900 mb-4 text-center">Táº¡o Äoáº¡n VÄƒn</h2>
                <p class="mb-6 text-slate-700 text-center">
                    Nháº­p cÃ¡c tá»« khÃ³a hoáº·c chá»§ Ä‘á» Ä‘á»ƒ táº¡o má»™t Ä‘oáº¡n vÄƒn báº±ng tiáº¿ng ÃŠ-Ä‘Ãª, sau Ä‘Ã³ á»©ng dá»¥ng sáº½ tá»± Ä‘á»™ng dá»‹ch sang tiáº¿ng Viá»‡t.
                </p>
                <div class="flex flex-col space-y-4">
                    <label for="paragraphKeywords" class="font-semibold text-slate-800">Tá»« khÃ³a/Chá»§ Ä‘á»:</label>
                    <textarea id="paragraphKeywords" rows="4" class="w-full p-4 rounded-lg border-2 border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300 resize-none" placeholder="VÃ­ dá»¥: Lá»… há»™i cá»“ng chiÃªng, nghá» dá»‡t thá»• cáº©m, cÃ¢y cÃ  phÃª..."></textarea>
                </div>
                <button id="generateParagraphButton" class="mt-6 w-full flex items-center justify-center gap-2 px-8 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">
                    <span class="button-icon">ğŸ“–</span>
                    <span class="button-text">Táº¡o Äoáº¡n VÄƒn</span>
                </button>
                <div id="paragraphOutputWrapper" class="mt-6 hidden grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex flex-col space-y-4">
                        <label for="edeParagraphOutput" class="font-semibold text-slate-800">Äoáº¡n vÄƒn tiáº¿ng ÃŠ-Ä‘Ãª</label>
                        <div class="relative w-full">
                            <textarea id="edeParagraphOutput" rows="8" readonly class="w-full p-4 rounded-lg bg-slate-100 border-2 border-slate-200 resize-none"></textarea>
                            <button id="speakEdeParagraphButton" title="PhÃ¡t Ã¢m Ä‘oáº¡n vÄƒn" class="absolute bottom-3 right-3 p-2 rounded-full bg-slate-200 hover:bg-slate-300 transition">
                                <span>ğŸ”Š</span>
                            </button>
                        </div>
                    </div>
                    <div class="flex flex-col space-y-4">
                        <label for="vietParagraphOutput" class="font-semibold text-slate-800">Báº£n dá»‹ch tiáº¿ng Viá»‡t</label>
                        <div class="relative w-full">
                            <textarea id="vietParagraphOutput" rows="8" readonly class="w-full p-4 rounded-lg bg-slate-100 border-2 border-slate-200 resize-none"></textarea>
                             <button id="speakVietParagraphButton" title="PhÃ¡t Ã¢m báº£n dá»‹ch" class="absolute bottom-3 right-3 p-2 rounded-full bg-slate-200 hover:bg-slate-300 transition">
                                <span>ğŸ”Š</span>
                             </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-10">
                <div class="mb-4 border-b border-slate-300 flex justify-center">
                    <button data-tab="imageTab" class="tab-button text-lg font-medium py-2 px-6 border-b-2 transition active">Dá»‹ch tá»« áº£nh</button>
                    <button data-tab="dictionaryTab" class="tab-button text-lg font-medium py-2 px-6 border-b-2 border-transparent text-slate-500 hover:text-slate-700 transition">Tá»« Ä‘iá»ƒn cÃ¡ nhÃ¢n</button>
                </div>

                <div class="tab-content card rounded-2xl shadow-lg p-6 md:p-8">
                    <div id="imageTab" class="space-y-6">
                        <p class="text-slate-700">Táº£i lÃªn má»™t hÃ¬nh áº£nh cÃ³ chá»©a vÄƒn báº£n Ä‘á»ƒ trÃ­ch xuáº¥t vÃ  dá»‹ch. Há»‡ thá»‘ng sáº½ tá»± Ä‘á»™ng nháº­n diá»‡n ngÃ´n ngá»¯ vÃ  thá»±c hiá»‡n dá»‹ch thuáº­t.</p>
                        <div class="p-6 border-2 border-dashed border-slate-300 rounded-lg text-center cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition" id="dropZone">
                            <input type="file" id="imageInput" class="hidden" accept="image/*">
                            <div id="imagePlaceholder">
                                <span class="text-4xl">ğŸ–¼ï¸</span>
                                <p class="mt-2 text-slate-600">KÃ©o vÃ  tháº£ áº£nh vÃ o Ä‘Ã¢y, hoáº·c <span class="font-semibold text-blue-600">nháº¥n Ä‘á»ƒ chá»n file</span></p>
                            </div>
                            <div id="imagePreviewWrapper" class="hidden relative">
                                <img id="imagePreview" class="max-h-60 mx-auto rounded-md shadow-md"/>
                                <button id="removeImageButton" class="absolute -top-2 -right-2 bg-white rounded-full p-1 shadow-md text-red-500 hover:bg-red-50 text-xl font-bold">&times;</button>
                            </div>
                        </div>
                        <button id="translateImageButton" class="w-full flex items-center justify-center gap-2 px-8 py-3 bg-teal-600 text-white font-semibold rounded-lg shadow-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-transform transform hover:scale-105 disabled:bg-slate-400 disabled:cursor-not-allowed disabled:transform-none">
                            <span class="button-icon">ğŸ“·</span>
                            <span class="button-text">Dá»‹ch tá»« áº£nh</span>
                        </button>
                    </div>

                    <div id="dictionaryTab" class="hidden space-y-6">
                        <p class="text-slate-700">XÃ¢y dá»±ng tá»« Ä‘iá»ƒn cá»§a riÃªng báº¡n. CÃ¡c báº£n dá»‹ch báº¡n thÃªm vÃ o Ä‘Ã¢y sáº½ Ä‘Æ°á»£c Æ°u tiÃªn sá»­ dá»¥ng, giÃºp cáº£i thiá»‡n Ä‘á»™ chÃ­nh xÃ¡c theo thá»i gian.</p>
                        <div>
                            <h3 class="text-lg font-semibold mb-3">ThÃªm tá»« má»›i</h3>
                            <div class="flex flex-col sm:flex-row gap-4">
                                <input type="text" id="newEdeText" placeholder="Nháº­p tá»« tiáº¿ng ÃŠ-Ä‘Ãª" class="flex-1 p-3 rounded-lg border-2 border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                <input type="text" id="newVietText" placeholder="Nháº­p nghÄ©a tiáº¿ng Viá»‡t" class="flex-1 p-3 rounded-lg border-2 border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                <button id="addTermButton" class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform transform hover:scale-105">ThÃªm</button>
                            </div>
                        </div>
                        
                        <div class="mt-6 pt-4 border-t border-slate-200">
                            <h3 class="text-lg font-semibold mb-3">Táº£i tá»« Ä‘iá»ƒn tá»« File</h3>
                            <p class="text-slate-600 text-sm mb-2">Chá»n má»™t file CSV (.csv) hoáº·c JSON (.json) chá»©a cÃ¡c cáº·p tá»« Ä‘iá»ƒn cá»§a báº¡n. Äá»‹nh dáº¡ng file CSV: <code class="bg-slate-100 p-1 rounded">"Tá»« ÃŠ-Ä‘Ãª","NghÄ©a tiáº¿ng Viá»‡t"</code>. Äá»‹nh dáº¡ng file JSON: <code class="bg-slate-100 p-1 rounded">[{ "ede": "tá»« ÃŠ-Ä‘Ãª", "viet": "tá»« tiáº¿ng Viá»‡t" }]</code></p>
                            <div class="flex flex-col sm:flex-row gap-4 items-center">
                                <input type="file" id="loadDictionaryFileInput" accept=".csv, .json" class="flex-1 p-2 rounded-lg border-2 border-slate-200">
                                <button id="loadDictionaryFromFileButton" class="px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105">
                                    <span class="button-icon">ğŸ“‚</span>
                                    <span class="button-text">Táº£i tá»« File</span>
                                </button>
                            </div>
                        </div>

                        <div class="mt-6 pt-4 border-t border-slate-200">
                            <h3 class="lg font-semibold mb-3">CÃ¡c báº£n dá»‹ch cá»§a báº¡n</h3>
                            <div id="customTranslationsList" class="max-h-80 overflow-y-auto space-y-3 pr-2">
                                <p class="text-slate-500 text-center py-4" id="dictionaryPlaceholder">Tá»« Ä‘iá»ƒn cÃ¡ nhÃ¢n cá»§a báº¡n Ä‘ang trá»‘ng.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <footer class="text-center mt-10 text-slate-500 text-sm">
            <p>PhÃ¡t triá»ƒn bá»Ÿi Báº±ng &copy; 2025</p>
            <p id="userIdDisplay" class="mt-1 opacity-70">Äang chá» xÃ¡c thá»±c ngÆ°á»i dÃ¹ng...</p>
        </footer>
    </div>

    <!-- Custom Message Box -->
    <div id="messageBox" class="message-box"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- GLOBAL STATE & UI ELEMENTS ---
    const state = {
        isAuthReady: false,
        isLoading: false,
        currentTab: 'imageTab',
        userId: null,
        dictionary: [],
        selectedImageFile: null,
        recognition: null,
        isRecording: false,
        speechSynthesisUtterance: null,
    };

    const ui = {
        inputText: document.getElementById('inputText'),
        outputText: document.getElementById('outputText'),
        additionalOutput: document.getElementById('additionalOutput'),
        additionalOutputWrapper: document.getElementById('additionalOutputWrapper'),
        translateButton: document.getElementById('translateButton'),
        generateExamplesButton: document.getElementById('generateExamplesButton'),
        summarizeExplainButton: document.getElementById('summarizeExplainButton'),
        recordButton: document.getElementById('recordButton'),
        speakTranslatedTextButton: document.getElementById('speakTranslatedTextButton'),
        speakAdditionalTextButton: document.getElementById('speakAdditionalTextButton'),
        tabs: document.querySelectorAll('.tab-button'),
        tabContents: document.querySelectorAll('.tab-content > div'),
        imageInput: document.getElementById('imageInput'),
        dropZone: document.getElementById('dropZone'),
        imagePlaceholder: document.getElementById('imagePlaceholder'),
        imagePreviewWrapper: document.getElementById('imagePreviewWrapper'),
        imagePreview: document.getElementById('imagePreview'),
        removeImageButton: document.getElementById('removeImageButton'),
        translateImageButton: document.getElementById('translateImageButton'),
        newEdeText: document.getElementById('newEdeText'),
        newVietText: document.getElementById('newVietText'),
        addTermButton: document.getElementById('addTermButton'),
        customTranslationsList: document.getElementById('customTranslationsList'),
        dictionaryPlaceholder: document.getElementById('dictionaryPlaceholder'),
        userIdDisplay: document.getElementById('userIdDisplay'),
        paragraphKeywords: document.getElementById('paragraphKeywords'),
        generateParagraphButton: document.getElementById('generateParagraphButton'),
        paragraphOutputWrapper: document.getElementById('paragraphOutputWrapper'),
        edeParagraphOutput: document.getElementById('edeParagraphOutput'),
        vietParagraphOutput: document.getElementById('vietParagraphOutput'),
        speakEdeParagraphButton: document.getElementById('speakEdeParagraphButton'),
        speakVietParagraphButton: document.getElementById('speakVietParagraphButton'),
        loadDictionaryFileInput: document.getElementById('loadDictionaryFileInput'),
        loadDictionaryFromFileButton: document.getElementById('loadDictionaryFromFileButton'),
        messageBox: document.getElementById('messageBox'),
    };

    // --- FIREBASE INITIALIZATION & AUTHENTICATION ---
    let app, db, auth;
    async function initializeFirebase() {
        try {
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

            if (!firebaseConfig.projectId) {
                showMessage("Lá»—i: Cáº¥u hÃ¬nh Firebase khÃ´ng há»£p lá»‡. Vui lÃ²ng kiá»ƒm tra láº¡i.");
                return;
            }

            const { initializeApp } = window.firebaseModules;
            app = initializeApp(firebaseConfig);
            
            const { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } = window.firebaseModules.auth;
            auth = getAuth(app);
            
            const { getFirestore } = window.firebaseModules.firestore;
            db = getFirestore(app);

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    state.userId = user.uid;
                    ui.userIdDisplay.textContent = `ID NgÆ°á»i dÃ¹ng: ${user.uid}`;
                    state.isAuthReady = true;
                    initDictionaryListener();
                    // Load initial dictionary data from the .docx file content
                    loadInitialDictionaryData();
                } else {
                    signIn(initialAuthToken);
                }
            });
        } catch (error) {
            console.error("Firebase Initialization Error:", error);
            showMessage(`Lá»—i khá»Ÿi táº¡o Firebase: ${error.message}`, 5000);
        }
    }
    
    async function signIn(initialAuthToken) {
        try {
            const { signInAnonymously, signInWithCustomToken } = window.firebaseModules.auth;
            if (initialAuthToken) {
                await signInWithCustomToken(auth, initialAuthToken);
            } else {
                await signInAnonymously(auth);
            }
        } catch (error) {
            console.error("Firebase Sign-in Error:", error);
            showMessage(`Lá»—i xÃ¡c thá»±c: ${error.message}`, 5000);
            ui.userIdDisplay.textContent = `Lá»—i xÃ¡c thá»±c: ${error.message}`;
        }
    }

    // --- UTILITY FUNCTIONS ---
    function showMessage(message, duration = 3000) {
        ui.messageBox.textContent = message;
        ui.messageBox.classList.add('show');
        setTimeout(() => {
            ui.messageBox.classList.remove('show');
        }, duration);
    }

    function setLoadingState(button, isLoading, originalText) {
        const textSpan = button.querySelector('.button-text');
        const iconSpan = button.querySelector('.button-icon');
        
        if (isLoading) {
            state.isLoading = true;
            button.disabled = true;
            textSpan.textContent = 'Äang xá»­ lÃ½...';
            iconSpan.innerHTML = '<div class="loader"></div>';
        } else {
            state.isLoading = false;
            button.disabled = false;
            textSpan.textContent = originalText;
            switch(originalText) {
                case 'Dá»‹ch': iconSpan.innerHTML = 'âœ¨'; break;
                case 'Táº¡o vÃ­ dá»¥': iconSpan.innerHTML = 'ğŸ’¡'; break;
                case 'TÃ³m táº¯t': iconSpan.innerHTML = 'ğŸ“'; break;
                case 'Táº¡o Äoáº¡n VÄƒn': iconSpan.innerHTML = 'ğŸ“–'; break;
                case 'Dá»‹ch tá»« áº£nh': iconSpan.innerHTML = 'ğŸ“·'; break;
                case 'Táº£i tá»« File': iconSpan.innerHTML = 'ğŸ“‚'; break;
            }
        }
    }
    
    function renderDictionary() {
        ui.customTranslationsList.innerHTML = '';
        if (state.dictionary.length === 0) {
            ui.customTranslationsList.appendChild(ui.dictionaryPlaceholder);
            ui.dictionaryPlaceholder.classList.remove('hidden');
        } else {
            ui.dictionaryPlaceholder.classList.add('hidden');
            state.dictionary.forEach(term => {
                const item = document.createElement('div');
                item.className = 'dictionary-item flex justify-between items-center p-3 rounded-lg border border-slate-200 transition-all duration-300';
                item.innerHTML = `
                    <div>
                        <p class="font-semibold text-slate-800">${term.ede}</p>
                        <p class="text-sm text-slate-500">${term.viet}</p>
                    </div>
                    <button data-id="${term.id}" class="delete-term-btn text-red-500 hover:text-red-700 p-1 rounded-full text-lg">&times;</button>
                `;
                ui.customTranslationsList.appendChild(item);
            });
        }
    }

    // --- GEMINI API CALLS ---
    async function callGeminiAPI(prompt, imageData = null, model = 'gemini-2.5-flash-preview-05-20') {
        const apiKey = "AIzaSyBVCTx8fPnGWFprwoT9bgixio_NUgvNG4k";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
        let chatHistory = [];
        let parts = [{ text: prompt }];

        if (imageData) {
            parts.push({
                inlineData: {
                    mimeType: imageData.mimeType,
                    data: imageData.data
                }
            });
        }
        chatHistory.push({ role: "user", parts: parts });
        const payload = { contents: chatHistory };

        let retryCount = 0;
        const maxRetries = 3;
        while (retryCount < maxRetries) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    if (response.status === 429) {
                        const delay = Math.pow(2, retryCount) * 1000 + Math.random() * 1000;
                        console.warn(`Throttled. Retrying in ${delay}ms...`);
                        await new Promise(res => setTimeout(res, delay));
                        retryCount++;
                        continue;
                    }
                    const errorData = await response.json();
                    throw new Error(`Lá»—i API: ${response.status} - ${errorData.error.message || 'Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh'}`);
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("Cáº¥u trÃºc pháº£n há»“i API khÃ´ng mong muá»‘n.");
                }
            } catch (error) {
                console.error("Lá»—i khi gá»i API Gemini:", error);
                if (retryCount >= maxRetries - 1) {
                    throw error;
                }
                retryCount++;
            }
        }
    }

    // --- MAIN APPLICATION LOGIC ---
    async function handleTranslate() {
        if (state.isLoading || !ui.inputText.value.trim()) return;
        setLoadingState(ui.translateButton, true, 'Dá»‹ch');
        ui.outputText.value = '';
        ui.additionalOutputWrapper.classList.add('hidden');
        
        const inputTextLower = ui.inputText.value.trim().toLowerCase();

        const customMatch = state.dictionary.find(t => t.ede.toLowerCase() === inputTextLower || t.viet.toLowerCase() === inputTextLower);
        if (customMatch) {
            const translatedText = customMatch.ede.toLowerCase() === inputTextLower ? customMatch.viet : customMatch.ede;
            ui.outputText.value = translatedText + " (tá»« tá»« Ä‘iá»ƒn cÃ¡ nhÃ¢n)";
            setLoadingState(ui.translateButton, false, 'Dá»‹ch');
            return;
        }
        
        const prompt = `Báº¡n lÃ  má»™t cÃ´ng cá»¥ dá»‹ch thuáº­t chuyÃªn nghiá»‡p. HÃ£y dá»‹ch vÄƒn báº£n sau Ä‘Ã¢y giá»¯a tiáº¿ng Viá»‡t vÃ  tiáº¿ng ÃŠ-Ä‘Ãª. Náº¿u vÄƒn báº£n lÃ  tiáº¿ng Viá»‡t, hÃ£y dá»‹ch sang tiáº¿ng ÃŠ-Ä‘Ãª. Náº¿u vÄƒn báº£n lÃ  tiáº¿ng ÃŠ-Ä‘Ãª, hÃ£y dá»‹ch sang tiáº¿ng Viá»‡t. Chá»‰ tráº£ vá» vÄƒn báº£n Ä‘Ã£ dá»‹ch, khÃ´ng thÃªm báº¥t ká»³ giáº£i thÃ­ch nÃ o. VÄƒn báº£n cáº§n dá»‹ch: ${ui.inputText.value}`;

        try {
            const translatedText = await callGeminiAPI(prompt);
            ui.outputText.value = translatedText;
        } catch (error) {
            ui.outputText.value = `ÄÃ£ xáº£y ra lá»—i trong quÃ¡ trÃ¬nh dá»‹ch: ${error.message}`;
            showMessage(`Lá»—i dá»‹ch: ${error.message}`, 5000);
        } finally {
            setLoadingState(ui.translateButton, false, 'Dá»‹ch');
        }
    }

    async function handleGenerateExamples() {
        if (state.isLoading || !ui.outputText.value.trim() || ui.outputText.value.includes("Káº¿t quáº£ dá»‹ch sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y")) return;
        setLoadingState(ui.generateExamplesButton, true, 'Táº¡o vÃ­ dá»¥');
        ui.additionalOutput.value = '';
        
        const prompt = `Táº¡o 3 cÃ¢u vÃ­ dá»¥ sá»­ dá»¥ng tá»« hoáº·c cá»¥m tá»« "${ui.outputText.value}" trong ngá»¯ cáº£nh khÃ¡c nhau. CÃ¡c cÃ¢u vÃ­ dá»¥ nÃ y nÃªn Ä‘Æ°á»£c dá»‹ch sang ngÃ´n ngá»¯ cÃ²n láº¡i (náº¿u tá»« gá»‘c lÃ  tiáº¿ng Viá»‡t, vÃ­ dá»¥ lÃ  tiáº¿ng ÃŠ-Ä‘Ãª vÃ  ngÆ°á»£c láº¡i). Chá»‰ tráº£ vá» cÃ¡c cÃ¢u vÃ­ dá»¥, má»—i cÃ¢u trÃªn má»™t dÃ²ng má»›i, khÃ´ng thÃªm báº¥t ká»³ giáº£i thÃ­ch nÃ o.`;

        try {
            const examples = await callGeminiAPI(prompt);
            ui.additionalOutput.value = examples;
            ui.additionalOutputWrapper.classList.remove('hidden');
        } catch (error) {
            ui.additionalOutput.value = `ÄÃ£ xáº£y ra lá»—i khi táº¡o vÃ­ dá»¥: ${error.message}`;
            showMessage(`Lá»—i táº¡o vÃ­ dá»¥: ${error.message}`, 5000);
        } finally {
            setLoadingState(ui.generateExamplesButton, false, 'Táº¡o vÃ­ dá»¥');
        }
    }

    async function handleSummarize() {
        if (state.isLoading || !ui.outputText.value.trim() || ui.outputText.value.includes("Káº¿t quáº£ dá»‹ch sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y")) return;
        setLoadingState(ui.summarizeExplainButton, true, 'TÃ³m táº¯t');
        ui.additionalOutput.value = '';

        const prompt = `TÃ³m táº¯t hoáº·c giáº£i thÃ­ch ngáº¯n gá»n Ã½ nghÄ©a cá»§a vÄƒn báº£n sau: "${ui.outputText.value}". Náº¿u vÄƒn báº£n phá»©c táº¡p, hÃ£y giáº£i thÃ­ch cÃ¡c Ä‘iá»ƒm chÃ­nh. Chá»‰ tráº£ vá» pháº§n tÃ³m táº¯t/giáº£i thÃ­ch, khÃ´ng thÃªm báº¥t ká»³ giáº£i thÃ­ch nÃ o khÃ¡c.`;

        try {
            const summary = await callGeminiAPI(prompt);
            ui.additionalOutput.value = summary;
            ui.additionalOutputWrapper.classList.remove('hidden');
        } catch (error) {
            ui.additionalOutput.value = `ÄÃ£ xáº£y ra lá»—i khi tÃ³m táº¯t/giáº£i thÃ­ch: ${error.message}`;
            showMessage(`Lá»—i tÃ³m táº¯t: ${error.message}`, 5000);
        } finally {
            setLoadingState(ui.summarizeExplainButton, false, 'TÃ³m táº¯t');
        }
    }
    
    // --- PARAGRAPH GENERATION LOGIC ---
    async function handleGenerateParagraph() {
        if (state.isLoading || !ui.paragraphKeywords.value.trim()) return;
        setLoadingState(ui.generateParagraphButton, true, 'Táº¡o Äoáº¡n VÄƒn');
        ui.edeParagraphOutput.value = '';
        ui.vietParagraphOutput.value = '';
        ui.paragraphOutputWrapper.classList.add('hidden');

        const prompt = `Táº¡o má»™t Ä‘oáº¡n vÄƒn khoáº£ng 50-70 tá»« báº±ng tiáº¿ng ÃŠ-Ä‘Ãª vá» chá»§ Ä‘á»: "${ui.paragraphKeywords.value}". Sau Ä‘Ã³, dá»‹ch Ä‘oáº¡n vÄƒn Ä‘Ã³ sang tiáº¿ng Viá»‡t. Sá»­ dá»¥ng Ä‘á»‹nh dáº¡ng sau Ä‘á»ƒ dá»… dÃ ng phÃ¢n tÃ¡ch: 
        Tiáº¿ng ÃŠ-Ä‘Ãª:
        [Äoáº¡n vÄƒn tiáº¿ng ÃŠ-Ä‘Ãª]

        Tiáº¿ng Viá»‡t:
        [Äoáº¡n vÄƒn tiáº¿ng Viá»‡t]`;

        try {
            const rawResponse = await callGeminiAPI(prompt);
            const edeParagraph = rawResponse.match(/Tiáº¿ng ÃŠ-Ä‘Ãª:\n([\s\S]*?)\n\nTiáº¿ng Viá»‡t:/i);
            const vietParagraph = rawResponse.match(/Tiáº¿ng Viá»‡t:\n([\s\S]*)/i);

            if (edeParagraph && vietParagraph) {
                ui.edeParagraphOutput.value = edeParagraph[1].trim();
                ui.vietParagraphOutput.value = vietParagraph[1].trim();
            } else {
                // Fallback if parsing fails
                ui.edeParagraphOutput.value = rawResponse;
                ui.vietParagraphOutput.value = 'KhÃ´ng thá»ƒ phÃ¢n tÃ¡ch báº£n dá»‹ch. Vui lÃ²ng thá»­ láº¡i hoáº·c Ä‘iá»u chá»‰nh tá»« khÃ³a.';
            }

            ui.paragraphOutputWrapper.classList.remove('hidden');
        } catch (error) {
            ui.edeParagraphOutput.value = `ÄÃ£ xáº£y ra lá»—i khi táº¡o Ä‘oáº¡n vÄƒn: ${error.message}`;
            ui.vietParagraphOutput.value = `ÄÃ£ xáº£y ra lá»—i khi táº¡o Ä‘oáº¡n vÄƒn: ${error.message}`;
            showMessage(`Lá»—i táº¡o Ä‘oáº¡n vÄƒn: ${error.message}`, 5000);
        } finally {
            setLoadingState(ui.generateParagraphButton, false, 'Táº¡o Äoáº¡n VÄƒn');
        }
    }


    // --- IMAGE TRANSLATION LOGIC ---
    function handleImageSelection(file) {
        if (file && file.type.startsWith('image/')) {
            state.selectedImageFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                ui.imagePreview.src = e.target.result;
                ui.imagePlaceholder.classList.add('hidden');
                ui.imagePreviewWrapper.classList.remove('hidden');
                ui.translateImageButton.disabled = false;
            };
            reader.readAsDataURL(file);
        }
    }

    async function handleTranslateImage() {
        if(state.isLoading || !state.selectedImageFile) return;
        setLoadingState(ui.translateImageButton, true, 'Dá»‹ch tá»« áº£nh');
        ui.outputText.value = '';
        ui.additionalOutputWrapper.classList.add('hidden');

        const reader = new FileReader();
        reader.onloadend = async () => {
            const base64Image = reader.result.split(',')[1];
            const mimeType = state.selectedImageFile.type;

            // Prompt has been updated for better OCR and translation
            const prompt = `TrÃ­ch xuáº¥t táº¥t cáº£ vÄƒn báº£n tá»« hÃ¬nh áº£nh nÃ y. Sau Ä‘Ã³, dá»‹ch vÄƒn báº£n Ä‘Ã³ sang tiáº¿ng Viá»‡t náº¿u vÄƒn báº£n gá»‘c lÃ  tiáº¿ng ÃŠ-Ä‘Ãª, hoáº·c sang tiáº¿ng ÃŠ-Ä‘Ãª náº¿u vÄƒn báº£n gá»‘c lÃ  tiáº¿ng Viá»‡t. Náº¿u khÃ´ng pháº£i cáº£ hai, chá»‰ cung cáº¥p vÄƒn báº£n Ä‘Ã£ trÃ­ch xuáº¥t. Chá»‰ xuáº¥t ra vÄƒn báº£n Ä‘Ã£ dá»‹ch hoáº·c vÄƒn báº£n Ä‘Ã£ trÃ­ch xuáº¥t náº¿u khÃ´ng thá»ƒ dá»‹ch. KhÃ´ng thÃªm báº¥t ká»³ lá»i giáº£i thÃ­ch nÃ o khÃ¡c.`;
            
            try {
                const translatedText = await callGeminiAPI(prompt, { data: base64Image, mimeType: mimeType });
                ui.outputText.value = translatedText;
            } catch (error) {
                ui.outputText.value = `ÄÃ£ xáº£y ra lá»—i khi dá»‹ch tá»« áº£nh: ${error.message}`;
                showMessage(`Lá»—i dá»‹ch áº£nh: ${error.message}`, 5000);
            } finally {
                setLoadingState(ui.translateImageButton, false, 'Dá»‹ch tá»« áº£nh');
            }
        };
        reader.readAsDataURL(state.selectedImageFile);
    }
    
    // --- FIREBASE DICTIONARY FUNCTIONS ---
    function initDictionaryListener() {
        if (!db || !state.userId || !state.isAuthReady) {
            console.warn("Firestore or User ID not ready for dictionary listener.");
            return;
        }
        const { collection, onSnapshot } = window.firebaseModules.firestore;
        const customDictionaryRef = collection(db, `artifacts/${__app_id}/users/${state.userId}/customDictionary`);
        
        onSnapshot(customDictionaryRef, (snapshot) => {
            state.dictionary = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderDictionary();
        }, (error) => {
            console.error("Error listening to dictionary changes:", error);
            showMessage(`Lá»—i táº£i tá»« Ä‘iá»ƒn: ${error.message}`, 5000);
        });
    }
    
    // Function to parse the .docx content and add it to Firestore
    async function loadInitialDictionaryData() {
        const docxContent = `Tá»«,NghÄ©a
Abao (dt),á»c bÆ°Æ¡u.  
AbÄƒn (dt),CÃ¡i chÄƒn (má»n). MsÄƒm abÄƒn: Ä‘Äƒp chÄƒn; AbÄƒn hmlei: ChÄƒn bÃ´ng.
AbÅ­ (dt),CÃ¡i hÅ©.
Adei (dt),Em. 
AdÄ• (dt),Háº¿n. 
Adham (dt),Má»™t nhÃ³m trong tá»™c ngÆ°á»i ÃŠÄ‘Ãª.
Adhan (dt),CÃ nh. Adhan kyÃ¢o: CÃ nh cÃ¢y.
Adhei (dt),TrÃ¡n. Adhei: TrÃ¡n rá»™ng.             
AdiÃª (dt),Trá»i. AdiÃª hjan: Trá»i mÆ°a.
AdiÃª khÃ´ng,NÄƒng háº¡n.
AdiÃª tlam,Xáº¿ chiá»u.
Adih (Ä‘t),Kia. Sang kÃ¢o ti anÃ´k adih: NhÃ  tÃ´i chá»— kia; HruÃª aguah 
,Adih kÃ¢o Ä‘ue# hiu: SÃ¡ng ngÃ y kia tÃ´i Ä‘i chÆ¡i.  
AdÃ´k (Ä‘gt),CÃ²n. KÃ¢o adÃ´k prÄƒk: TÃ´i cÃ²n tiá»n; AdÃ´k hdyÃ¸p: CÃ²n sá»‘ng.
AdrÄƒng (dt),RÆ¡m ráº¡. MkÄƒm adrÄƒng: Ä‘á»‘ng rÆ¡m.
Adring (dt),"HiÃªn nhÃ  sÃ n. AmyÃ¸ kÃ¢o [hu mdiÃª ti adring: Máº¹ tÃ´i phÆ¡i luÃ´a á»Ÿ hiÃªn nhÃ  sÃ n."
AdrÅk (dt),Con cÃ³c.
AduÃ´n (dt),BÃ  (ná»™i
AdÅ­ (dt),1.PhÃ²ng. Adu\ pyÃ¸t: PhÃ²ng ngá»§; Adu\ hriÄƒm: PhÃ²ng há»c. 
,2. Lá»›p. Adu\ nÄƒm: Lá»›p 6; Adu\ pluh dua: Lá»›p 12. 
,3. CÃ¡i Ã´. Adu\ ju\: eÃ¸ mÃ u Ä‘en.
AdÅ­ bruÄƒ (dt),VÄƒn phÃ²ng.
AdÅ­ gÄ­t gai bruÄƒ kiÄƒ kriÃª (dt) ,Â  PhÃ²ng hÃ nh chÃ­nh.
AdÅ­ tÄ­ng yap (dt),PhÃ²ng káº¿ tÃ­n.
AdÅ­ng (dt),MÅ©i. {Äƒng adu\ng: Lá»— mÅ©i.
AÃª (dt),EÃ¸ng (ná»™i
AÃª Ãªa drao (dt),BÃ¡c sÄ©. AÃª Ãªa drao jing pÃ´ mdrao klei ruÄƒ kÆ¡ jih jang mnuih: BÃ¡c sÄ© lÃ  ngÆ°á»i chá»¯a bá»‡nh cho má»i ngÆ°á»i.
Agam (tt),Loáº¡n luÃ¢n. Klei ngÄƒ agam jing soh ho\ng klei bhiÄƒn anak ÃŠÄ‘Ãª: Loáº¡n luÃ¢n lÃ  hÃ nh Ä‘á»™ng vi pháº¡m phong tá»¥c cá»§a ngÆ°á»i ÃŠÄ‘Ãª.
Agha (dt),Rá»…. Agha kram: Rá»… tre.
Aguah (tráº¡ng tá»«),Buá»•i sÃ¡ng. Aguah Æ°m: SÃ¡ng sá»›m; Aguah mgi: SÃ¡ng mai; Aguah mbruÃª: SÃ¡ng hÃ´m qua. 
AguÄƒt (dt),"Con bá» cáº¡p. AguÄƒt du\] ruÄƒ snÄƒk: Bá» cáº¡p Ä‘á»‘t ráº¥t Ä‘au."
Ah (hÆ° tá»«)              ,áº . KÃ¢o thÃ¢o klei soh leh amyÃ¸ ah: con biáº¿t lá»—i rá»“i máº¹ áº¡.
Ai (dt),Sá»©c. Ai ktang: Sá»©c máº¡nh.
Ai hriÄƒm (dt),Há»c lá»±c.
Ai Ãªwa (dt) (tt),KhÃ­ tháº¿
Ai mÄ­n (Ä‘gt),Suy nghÄ©. Tui si ai kÃ¢o myÃ¸n: Theo tÃ´i nghÄ©.
AjÄ­k (dt),EÃ¹aÃºch. 
Ak (dt),Con quáº¡. Ju\ mse\ si ak: Ä‘en nhÆ° quáº¡.
AkÄƒt (dt),Bá»¥i (khÃ³m). AkÄƒt kram: Bá»¥i tre.
AkÃ¢o (Ä‘gt),Xin. AkÃ¢o prÄƒk: Xin tiá»n; AkÃ¢o Ãªa mnÄƒm: Xin nÆ°á»›c uá»‘ng.
Ala (dt),Con rÄƒn. Ala knÄƒl: RÄƒn giun; Ala mtah: RÄƒn lá»¥c.
Ala Äar (dt),"Tá»• quá»‘c. Ala ]ar Viá»‡t Nam: Tá»• quá»‘c Viá»‡t Nam. "
Ala Äar taÄ Ãªngao (dt) ,NÆ°á»›c ngá»‹i.
Alah (tt),LÆ°á»i biáº¿ng. Alah mÄƒ bruÄƒ: LÆ°á»i lÃ m viá»‡c; Mnuih alah: NgÆ°á»i lÆ°á»i biáº¿ng.
Alah alan (tt),Uá»ƒ oáº£i. MÄƒ bruÄƒ alah alan: LÃ m viá»‡c uá»ƒ oáº£i.
AlÄƒ (dt),MÄƒt. PyÃ¸t alÄƒ: NhÄƒm mÄƒt.
AlÄƒ kÄ­ng (dt),KÃ­nh. TruÄƒ alÄƒ kyÃ¸ng: Ä‘eo kÃ­nh.
AlÄƒ mmÄƒt (tt),Cáº­n thá»‹. AlÄƒ mmÄƒt kjham: MÄƒt cáº­n thá»‹ náº·ng.
"AlÄ•, AluÃªÌ† (Ä‘gt)",Nháº£.  Ale\ djah ÃªhÄƒng: Nháº£ bÃ£ tráº§u.
AlÃª (dt),Le.
AlÃ´k (Ä‘gt),"Lá»™t. AlÃ´k boh [Æ¡r: Lá»™t vá» quáº£ bÆ¡."
Alum akÃ¢o (Ä‘gt),Cáº§u xin. Alum akÃ¢o kÆ¡ aÃª Ãªa drao Ä‘ru mdrao brei anak kÃ¢o: Cáº§u xin bÃ¡c sÄ© cá»©u chá»¯a con tÃ´i.
Alum kkuh (Ä‘gt),KÃ­nh thÆ°a.
Alum mpÅ­ (Ä‘gt),TrÃ¢n trá»ng
AlÅ­ (dt),ThÃ´n
AlÅ­ wÄƒl (dt),VÃ¹ng.
AlÅ­ Æ€uÃ´n prÅng,Phá»‘ phÆ°á»ng.
AlÆ°Ã± (tt),Gá»›m. AlÆ°yÃ» bÆ°yÃ»: Gá»›m giáº¿c.
Am pul pui (dt) ,BÃ³ng Ä‘Ã¨n. Am pul pui kmlÄƒ: BÃ³ng Ä‘iá»‡n.
Ama (dt),Bá»‘ (cha).
Amai (dt),Chá»‹.
AmÃ¢o (pht),KhÃ´ng. AmÃ¢o mÃ¢o: KhÃ´ng cÃ³; KÃ¢o amÃ¢o mÃ¢o prÄƒk: TÃ´i khÃ´ng cÃ³ tiá»n; AmÃ¢o guÃ´p: KhÃ´ng há»£p.
AmÃ¢o dah (lt),Hay (hoáº·c). KÃ¢o amÃ¢o dah ih nao: TÃ´i hay anh Ä‘i.
AmÃ¢o dÆ°i ,Â 
AmÃ¢o djÅ ai (tt),KhÃ´ng vá»«a lÃ²ng. AÃ¡u mÄƒ bruÄƒ amÃ¢o djo\ ai amyÃ¸ ama: NÃ³ lÃ m viá»‡c khÃ´ng vá»«a lÃ²ng bá»‘ máº¹.
AmÃ¢o djÅ knÅng (trgt),Cháº³ng nhá»¯ng. AmÃ¢o djo\ kno\ng hriÄƒm hrÄƒ kriÄƒng Ã´h
AmÃ¢o kpÄƒ (tt),Báº¥t chÃ­nh. Klei ngÄƒ amÃ¢o kpÄƒ: HÃ nh Ä‘á»™ng báº¥t chÃ­nh. 
AmÃ¢o klÄƒ mngaÄ (tt),"Báº¥t minh. Mje\ mjuk amÃ¢o klÄƒ mnga]: Quan há»‡ báº¥t minh."
AmÃ¢o rÄƒk (Ä‘gt),Báº¥t cá»©
AmÃ¢o rÄƒk rai (hÆ° tá»«),Báº¥t diá»‡t. Klei Ä‘ao\ knang amÃ¢o rÄƒk rai: Niá»m tin báº¥t diá»‡t.
AmÃ¢o thÃ¢o knga (tt),VÃ´ Æ¡n.: NgÆ°á»i vÃ´ Æ¡n.
AmÃ¢o mÃ¢o tÅ­ Æ° (Ä‘gt),Pháº£n Ä‘á»‘i. TÃ´i pháº£n Ä‘á»‘i anh ta lÃ m viá»‡c khÃ´ng Ä‘Ãºng.
AmiÃªt (dt),Cáº­u. Anei amiÃªt kÃ¢o: Ä‘Ã¢y lÃ  cáº­u tÃ´i.
AmÄ­ (dt),Máº¹ (mÃ¡).
AmÄ­ ama hÄ‘eh (dt),Phá»¥ huynh.
AmlÆ¡Ì†k (dt),"CÃ¡m. AmlÆ¡\k ]iÃªm u\n: CÃ¡m lá»£n."
Amra (pht),Sáº½. KÃ¢o amra nao: TÃ´i sáº½ Ä‘i.
Amrak (dt),Con cÃ´ng. RÃ´ng amrak pioh dlÄƒng: NuÃ´i cÃ´ng lÃ m cáº£nh.
AmrÃªÌ†Ä (dt),"EÃ»oÃ»t. Sang kÃ¢o mÃ¢o pla amre#]: nhÃ  tÃ´i cÃ³ trá»“ng á»›t."
Amung mtei (dt),Buá»“ng chuá»‘i. AmyÃ¸ koh amung mtei: Máº¹ cháº·t buá»“ng chuá»‘i.
Amung mdiÃª (dt),BÃ´ng luÃ´a. 
Amung kngan (dt),Mu tay.
Amung Å­n (dt),MÃµm lá»£n (heo).
AmuÃ´n (dt),ChÃ¡u (chÃ¡u vá»›i cáº­u
Ana ,I.(dt) cÃ¢y. Ana kneh: cÃ¢y mÃ­t. Ana truÃ´l: cÃ¢y á»•i.
                                  ,Ii.(tt) giá»‘ng cÃ¡i (tá»« dÃ¹ng chá»‰ Ä‘á»™ng váº­t giá»‘ng cÃ¡i). UyÃµn ana: lá»£n nÃ¡i; mnu\ ana: gÃ  mÃ¡i.
Anak (dt),Con (dÃ¹ng cho ngÆ°á»i). 
Anak alÄƒ (dt),Con ngÆ°Æ¡i.
Anak Ä­ (dt),Tráº» sÆ¡ sinh.
Anak rai (dt),Con rá»“ng.
Anal (dt),Con sÃ¢u nÃ¡i.
Anal kÅ (dt),CÃ¡i gá»‘i.
AnÄƒn ,I.(dt) tÃªn. AnÄƒn kÃ¢o nam: tÃªn tÃ´i lÃ  nam.
                                  ,Ii.(Ä‘áº¡i tá»« chá»‰ Ä‘á»‹nh) Ä‘Ã³
AnÄƒn kdrÆ°h (dt),Danh hiá»‡u.
AnÄƒp (giÆ¡Ã¯i tá»«),TrÆ°á»›c. Ti anÄƒp: PhÃ­a trÆ°á»›c. 
Anei (Ä‘t),"ÄÃ¢y. Anei [yÃ¸ng kÃ¢o: Ä‘Ã¢y lÃ  báº¡n tÃ´i. KÃ¢o mÄƒ bruÄƒ ti anei: tÃ´i lÃ m viá»‡c á»Ÿ Ä‘Ã¢y. "
Aneh (dt),DeÃ£.
AngÄ­n (dt),GiÃ³. AngyÃ¸n dÆ°r: GiÃ³ bÄƒc. AngyÃ¸n Ä‘ru\ng: GiÃ³ lá»‘c
AngÄ­n ÃªbÅ­ (dt),BÃ£o.
AngÆ°r (Ä‘gt),Ngáº©ng. AngÆ°r ko\: Ngáº©ng Ä‘áº§u.
Anghar (Ä‘gt),"NgÃ¡y. PyÃ¸t anghar [rok [rok: Ngá»§ ngÃ¡y khÃ² khÃ²."
AnÃ´k (dt),NÆ¡i
AnÃ´k dÃ´k (dt),NÆ¡i á»Ÿ
AnÃ´k dÃ´k Ãªjai (dt),NÆ¡i táº¡m truÃ´.
AnÃ´k mjÆ°h (dt),NÆ¡i dá»«ng. AnÃ´k mjÆ°h Ãªdeh: Báº¿n xe.
AnÃ´k mjÆ°h mran (dt),Cáº£ng.
AnuÄƒ (dt),CÃ¡i cÆ°a.
AnÅ­ng (dt),TuÃ´i. Anu\ng hÄƒt: TuÃ´i thuá»‘c lÃ¡.
Anur (dt),Con duÃ´i.
Anut (dt),CÃ¡i cuÃ´c Ã¡o. Sa boh anut: Má»™t cÃ¡i cuÃ´c. 
AÃ±Å­ (dt),Háº¡t cÆ°á»m (chuá»—i). Kngan buh ayÃ»u\: Cá»• tay Ä‘eo cÆ°á»m.
AÃ±uÃª (dt),Chiáº¿u. Lang ayÃ»uÃª kÆ¡ adei pyÃ¸t: Tráº£i chiáº¿u cho em ngá»§.
AÃ±huÃ´r (Ä‘gt),"Duá»—i. AyÃ»huÃ´r jÆ¡\ng ]iÄƒng Ä‘Äƒm Ãªgah: Duá»—i chÃ¢n cho Ä‘á»¡ má»i."
AÃ±huih (Ä‘gt),Há»‰. AyÃ»huih Ãªa adu\ng: Há»‰ mÅ©i.
Ao (dt),AoÃ»o. Ao ko#: AoÃ»o trÄƒng. Ao hjan: AoÃ»o mÆ°a.
Ap (Ä‘gt),ÄÃ¨.
Ap gÆ°Ì† (Ä‘gt) ,ÄÃ n Ã¡p.
AprÅng (dt),BÃ¡c (chá»‹ cá»§a máº¹).
ArÄƒ anei (trgt),Hiá»‡n nay
ArÄƒn (Ä‘gt),Ráº·n. ArÄƒn kkiÃªng: Ráº·n sinh.
ArÄƒng (Ä‘t),NgÆ°á»i ta. KÃ¢o hmÆ°\ arÄƒng blu\ lu kÆ¡ ayo\ng: TÃ´i nghe ngÆ°á»i ta nÃ³i nhiá»u vá» anh.
Areh (dt),Con rá»‡p. Areh ke\ ktÄƒl Ãªdi: Rá»‡p cÄƒn ngá»©a tháº­t.
AriÃªng (dt),Con cua.
AruÄƒt (dt),GÃ¢n
Arul (dt),Há» cá»§a ngÆ°á»i ÃŠÄ‘Ãª.
ArÆ°p aram (Ä‘gt),"Äe dá»a. Phung roh arÆ°p aram mdjiÃª jih mnuih [uÃ´n sang: bá»n giáº·c Ä‘e dá»a giáº¿t sáº¡ch dÃ¢n lÃ ng."
AsÄƒp (dt),1. Lá»i. AsÄƒp blu\: Lá»i nÃ³i.
,2. KhÃ³i. AsÄƒp pui: KhÃ³i lá»­a.
AsÄƒp mtrÅ­n (dt),Nghá»‹ quyáº¿t
AsÄƒr (dt),1.háº¡t
,2. ViÃªn. AsÄƒr phao: ViÃªn Ä‘áº¡n.
Aseh (dt),Con ngá»±a. Sang kÃ¢o mÃ¢o rÃ´ng dua drei aseh ko#: NhÃ  tÃ´i cÃ³ nuÃ´i hai con ngá»±a trÄƒng.
AsÃ¢o (dt),Con chÃ³. RÃ´ng dua drei asÃ¢o: NuÃ´i hai con chÃ³.
Asei (dt),ThÃ¢n
Asei mlei (dt),ThÃ¢n thá»ƒ
Asei wah (dt),LÆ°á»¡i cÃ¢u.
AtÄƒt (Ä‘gt),ÄÃ³n. AtÄƒt ba kÃ¢o nao truh ti anÃ´k ayo\ng mÄƒ bruÄƒ: ÄÃ³n tÃ´i Ä‘i Ä‘áº¿n nÆ¡i anh lÃ m viá»‡c.
AtÃ¢o (dt),NgÆ°á»i cháº¿t (thi hÃ i ngÆ°á»i cháº¿t).
Ai tiÃª (dt),Táº¥m lÃ²ng.
Ai tiÃª jÄƒk (dt),Sá»± tá»‘t bá»¥ng
Ai tiÃª kriÄƒng (tt),ChÄƒm chá»‰
AtÅ­t (dt),Äá»‘t. Atu\t kram: Ä‘á»‘t tre; atu\t kÄ‘iÃªng kngan: Ä‘á»‘t ngÃ³n tay. Atu\t klang ro\ng: Ä‘á»‘t sá»‘ng. 
AtiÃªng (dt),NhÃ¡nh. AtiÃªng Ãªya: NhÃ¡nh gá»«ng.
Awa (dt),BÃ¡c (anh trai vÃ  chá»‹ gÃ¡i cá»§a bá»‘). Awa Há»“: BÃ¡c Há»“. 
Awak (dt),CÃ¡i theÃ£a.
Awak boh (dt),CÃ¡i muÃ´i (lÃ m bÄƒÃ´Ã»ng tre).
Awan (dt),KhuÃ´c
AwÄƒt (tt),Yáº¿u
AyÅng (dt),Anh. Ayo\ng adei: Anh em.
AyÅng khua (dt),Anh cáº£.
,Â 
A,Â 
Al (Ä‘gt),MÄƒng
Al ÄÃ´Ã± (tt),Giáº­n há»n.
Am (Ä‘gt),"NÆ°á»›ng. AÃ»m ]yÃ¸m ]iÄƒng bi ksÄƒ: NÆ°á»›ng thá»‹t cho chÃ­n."
Ap (Ä‘gt),1. Bá»‹t. AÃ»p Ä‘yÃ¸ng Ãªa: Bá»‹t á»‘ng nÆ°á»›c. 
                                  ,2. AoÃ»p. AÃ»p knga ti mtih: AoÃ»p tai vÃ o vÃ¡ch.
,3. ChÆ°á»m. KdÃ´ pioh Äƒp: TuÃ´i chÆ°á»m.
At (pht),1. VÃ³n. KÃ¢o Äƒt dÃ´k ti anÃ´k hÄ‘Äƒp: TÃ´i vÃ³n á»Ÿ chá»— cÅ©.
,"2. CÅ©ng. AÃ¡u Äƒt myÃ¸n mse\ si kÃ¢o mÆ¡h: NÃ³ cÅ©ng nghÄ© nhÆ° tÃ´i; Ih la] snÄƒn"
,Â 
B,Â 
Ba (Ä‘gt),Mang. DjÄƒ ba: Mang theo. 
Ba tian (Ä‘gt),Mang báº§u (cÃ³ chá»­a dÃ¹ng cho ngÆ°á»i).
Ba kÄ‘i (Ä‘gt),Bá»“i thÆ°á»ng.
Bai (dt),Giá». Bai djah: Giá» rÃ¡c.
Bai Ä‘ih (dt),NÃ´i (em beÃ´).
Ban (Ä‘gt),TrÆ°á»n.
BÄƒ (Ä‘gt),Äá»¥ng
BÄƒk (Ä‘gt),Äeo (vÃ o cá»•). BÄƒk klei mah: Ä‘eo dÃ¢y chuyá»n vÃ ng.
BÄ• (tht),ThÃ´i! (yÃ´ há»‘i thuÃ´c). Nao be\ : Ä‘i thÃ´i!
BÃª (dt),DÃª (con váº­t). BÃª knÃ´: DÃª Ä‘á»±c; Ana bÃª: DÃª máº¹.
Bhang (dt),HÃ¨
BhaÃ± (Ä‘gt),HÄƒt hÆ¡i.
BhÄ­ (dt),TÃªn cá»§a má»™t lá»‹i chim. }yÃ¸m bhyÃ¸: Chim phÃ­.
BhiÄƒn (phoÃ¯ tá»«),ThÆ°á»ng. AÃ¡u bhiÄƒn kgu\ Ãªla: NÃ³ thÆ°á»ng dáº­y muá»™n.
BhiÃ¢o (tt),Má»™t luÃ´c
BhiÃ¢o hin (pht),ChÃ³ng vÃ¡nh.
BhiÃ¢o riÃ¢o rit,Chá»‘c lÃ¡t
BhÄ­r (Ä‘gt),NeÃ´m.
BhÄ­t (tt),Ráº­m.
BhÄ­t pum/bhÄ­t dliÃª (dt) ,Bá»¥i ráº­m.
BhÃ´k gah (dt) ,NgÄƒn nhá» á»Ÿ gian trÆ°á»›c nhÃ  sÃ n ÃŠÄ‘Ãª. 
BhÅng bhÅng (Ä‘gt),"AÃ²o áº¡t. K[iÄƒ bho\ng bho\ng mse\ si klap: Ra Ã o áº¡t nhÆ°  má»‘i."
Bhung aguah (trt),Suá»‘t Ä‘Ãªm. Mlam bhung aguah hlo\ng amÃ¢o pyÃ¸t: Suá»‘t Ä‘Ãªm khÃ´ng ngá»§.
Bhung bhang (tt),SÃ¡ng sá»§a.
Bi,1. (lt) CÃ²n. KÃ¢o nao mÄƒ bruÄƒ bi anak kÃ¢o dÃª nao sang hrÄƒ: TÃ´i Ä‘i lÃ m cÃ²n con tÃ´i Ä‘i há»c. 
,"2. (trt) Pháº£i. Bi nao mtam ]iÄƒng kÆ¡ hmao: Pháº£i Ä‘i ngay cho ká»‹p."
Bi Äƒl (Ä‘gt),Giáº­n nhau.
Bi blÅ­ (Ä‘gt),ÄÃ m thoáº¡i
Bi ÄÄ­k (Ä‘gt),Váº­t nhau.
Bi dÆ¡Ì†k bi dria (tt),Rá»™n rÃ£. 
Bi Ãªdah (Ä‘gt),Thá»ƒ hiá»‡n
Bi hlÄ­ (tt),HÃ²a thuáº­n. 
Bi hdÆ¡r (Ä‘gt),TÆ°á»Ÿng nhá»›.
Bi kbÆ°i (Ä‘gt),CÃ¡ch ly. 
Bi kjÄƒp (Ä‘gt),Cá»§ng cá»‘. 
Bi kmiÃªk (Ä‘gt),EÃ¸m nhau
Bi lar (Ä‘gt),Trau dá»“i. 
Bi leh (Ä‘gt),Há»‹n thÃ nh. 
Bi liÃª (Ä‘gt),TiÃªu
Bi lir (gt),Liá»n nhau (sÃ¡t). 
Bi lÃ´ng,1. Thi (thi cá»­). Bi lÃ´ng klei ÃŠÄ‘Ãª: Thi tiáº¿ng ÃŠÄ‘Ãª.
,2. Äua. Bi lÃ´ng Ãªdeh: Ä‘ua xe.  
Bi lui (Ä‘gt),Ly dá»‹
Bi mÄ‘Ä­ (Ä‘gt),NÃ¢ng cao. Bi mÄ‘yÃ¸ klei thÃ¢o sÄƒng: NÃ¢ng cao kiáº¿n thá»©c.
Bi mÄ­n (Ä‘gt),Suy nghÄ©.  
Bi mlih (Ä‘gt),Thay Ä‘á»•i.
Bi mtlaih (Ä‘gt),Giáº£i thÃ­t
Bi ruÃªÌ† (Ä‘gt),Káº¿t thuÃ´c
Bi rÅ­ng (Ä‘gt),GÃ¢y rá»‘i
Bi Å­k bi Äƒk (tt),Táº¥p náº­p (chá»‰ sá»± á»“n Ã o
Bi yÃ´ng (tt),YoÃ¹ láº¡i nhau.  
BiÃªng (Ä‘gt),Äáº­p. }Äƒm biÃªng: Ä‘Ã¡nh Ä‘áº­p.
BiÃªr (tt),1. LÃ¹n. Jar mnuih biÃªr: DÃ¡ng ngÆ°á»i lÃ¹n. 
,2.Tháº¥p. Ana kyÃ¢o biÃªr: CÃ¢y tháº¥p.
Bih (dt),Thuá»™c nhÃ³m dÃ¢n tá»™c ÃŠÄ‘Ãª.
Bip (dt),Vá»‹t. Bip knÃ´: Vá»‹t Ä‘á»±c.
Bip Ãªa (dt),Con vá»‹t nÆ°á»›c.
Bir (dt),Vá»‰a hÃ¨. EÃ¹bat ti dlÃ´ng bir Ãªlan: Ä‘i (bá»™) trÃªn vá»‰a hÃ¨.
Biut (dt),MÃ¢y.
BlaÄ (Ä‘gt),"Má»•. Bla] prÃ´] Ãªbeh: Má»• ruá»™t thá»«a."
Blah ,I.(Ä‘gt)1. Bá»•. Blah djuh: bá»• cá»§i
          ,2. Cháº». Blah Ä‘rao: Cháº» ná»©a.
,Ii. Tá»« dÃ¹ng Ä‘á»ƒ Ä‘áº¿m sá»‘ cÃ¡i
Blang (Ä‘gt),Ná»Ÿ (hoa). Mnga blang: Hoa ná»Ÿ.
Blao (tt),NhÃ¡t. 
BliÆ°Ì† ,I.(Ä‘gt). Láº­t.  EÃ¹deh bliÆ°\: xe láº­t.
,Ii.(dt). Láº§n. EÃ¹ma bliÆ°\
BlÃ´ (tt),Báº§u (bÄ©nh). {o# blÃ´: Máº·t báº§u bÄ©nh.
BlÅ­ (Ä‘gt),"NÃ³i. Blu\ Ãªku\t: NÃ³i sau lÆ°ng; Blu\ lo\k luÄƒl:NÃ³i ngá»ng; Blu\ mdiÃªr: NÃ³i quanh co; Blu\ mgao: NÃ³i quÃ¡; Blu\ mha]:"
BlÅ­ bi hmÆ°Ì† (Ä‘gt),NÃ³i khÃ³e.
BlÅ­ mhriÃªng (Ä‘gt),NÃ³i bÃ³ng.
BlÅ­ tlao (Ä‘gt),CÆ°á»i nÃ³i.
BlÅ­ wah wÆ¡ (Ä‘gt),NÃ³i trá»‘ng khÃ´ng.
BlÅ­ myÃ¢o (Ä‘gt),NÃ³i kheÃ´o. 
BlÅ­ yÄƒl (Ä‘gt),NÃ³i nÄƒng. 
Boh ,I.(dt) 1. Quáº£
,2. Trá»©ng. Boh mnu\: Trá»©ng gÃ .
,"Ii.(Ä‘gt) giáº·t. Boh ]hum ao: giáº·t quáº§n Ã¡o."
,"Iii. Tá»« dÃ¹ng Ä‘á»ƒ Ä‘áº¿m cÃ¡i. Dua boh k]ok (]hiÃªn): hai cÃ¡i ly (cheÃ´n). Sa boh sang: má»™t ngÃ´i nhÃ . NÄƒm boh ]ar: sÃ¡u tá»‰nh. EÃ¹ma boh ÃªyÃ»an: nÄƒm báº­c thang."
Boh anÄƒn (dt),Danh tá»«.
Boh anut (dt),CÃ¡i khuy (cuÃ´c Ã¡o). KÄƒ boh anut ao: Ä‘Æ¡m cuÃ´c Ã¡o.
Boh areh (dt),Long nÃ£o.
Boh bip ÃªÄ‘ai (dt),Trá»©ng vá»‹t lá»™n.
Boh dlÃ´ng (dt),Chiá»u cao
Boh Ä‘ÃªÌ†Ä (dt),"Hoa vÄƒn. MyÃ»am boh Ä‘e#]: Dá»‡t hoa vÄƒn."
Boh blÅ­ (dt),Tá»« ngá»¯ (tá»« vá»±ng).
Boh blÅ­ mÄuÃª (dt),Giá»›i tá»«
Boh Æ€ai (dt),Diá»‡n tÃ­ch.
Boh Æ€leh (dt),Tháº­n
Boh hrÄƒ (dt),Chá»¯
Boh jhat (tt),Sá»± xáº¥u xa.
Boh jing (dt),1. TÃ­nh tá»«.
,2. ThÃ nh quáº£.
Boh kÃªÌ†Ã± (dt),BÃ¡nh chÃ¨.
Boh kÅ (dt),CÃ¡i Ä‘áº§u. RuÄƒ kno\ng sa boh ko\: Ä‘au má»—i cÃ¡i Ä‘áº§u.
Boh kpÄƒt (dt),Bá»“ hÃ²n. PhyÃ¸ mse\ syÃ¸ boh kpÄƒt : Ä‘Äƒng nhÆ° quáº£ bá»“ hÃ²n.
Boh lÄƒn (dt),TrÃ¡i Ä‘áº¥t. Boh lÄƒn dar: TrÃ¡i Ä‘áº¥t quay.
Boh mâ€™Ã´Ì†(dt),1. Háº§u (ngÆ°á»i)
,2. Xá»‹i rá»«ng (há»™t nhá»).
Boh mdÃª (dt),Äáº·c thÃ¹.
Boh mtuh (dt),Lá»±u Ä‘áº¡n.
Boh nik (nak) (tt),Nháº¥t lÃ . 
Boh pÄƒm (dt),Bá»“ káº¿t. }Ã´ ko\ ho\ng Ãªa boh pÄƒm: Gá»™i Ä‘áº§u bÄƒÃ´Ã»ng nÆ°á»›c bá»“ káº¿t.
Boh pha (dt),BÄƒp váº¿.
Boh phÅ­n (dt),Ná»™i dung. 
Boh pia (dt),Phá»¥ Ã¢m.
Boh tih (dt),BÄƒp chÃ¢n.
Boh tluÃ´n (dt),CÃ¡i mÃ´ng.
BÅ (tt),Äáº§y. 
BÅk (Ä‘gt),SÆ°ng
BÅk yÆ¡i (dt),Quai bá»‹.
BÅk wi wu (Ä‘gt),SÆ°ng vÃ¹. 
BÅng bÅ­ (dt),BeÃ£m bá»‹p.
BÃ´ng (dt),Quan tÃ i (hÃ²m).
BÆ¡ bhÃ´ (tt),EÃ¸uÃ¯ng á»™c.
Braih (dt),"Gáº¡o. Ple#] braih: Vo gáº¡o."
Braih ka hroh (dt),Gáº¡o lá»©c.
Braih mkuÃªÌ† (dt),Gáº¡o (gáº¡o thÃ³c nÃ³i chung). Sang kÃ¢o amÃ¢o mÃ¢o braih mkue# Ã´h: NhÃ  tÃ´i khÃ´ng cÃ³ gáº¡o thÃ³c geÃ£ cáº£.  
Brang (dt),Gai (cÃ¢y gai).
Brei (Ä‘gt),Cho. 
Bring (tt),Rá»‰
BrÃ´Ì†(dt),ÄÃ n. Pe\ bro#: Ä‘Ã¡nh Ä‘Ã n (ghi ta).
Bru bra (Ä‘gt),TÃ¡n loáº¡n.
BrÅ­ (tt),Thá»‘i. {Ã¢o bru\: HÃ´i thá»‘i. 
BrÅ­ hiÄƒ (tt),Thá»‘i hoÄƒc
BruÄƒ (dt),Viá»‡c.
BruÄƒ ÄuÄƒn (dt),Quy Ä‘á»‹nh
BruÄƒ knÄƒl (dt),Nhiá»‡m vá»¥
BruÄƒ tÅ­ ngÄƒ (dt),Nhiá»‡m vá»¥
Buh (Ä‘gt),Äeo (vÃ o cá»• tay). Buh ayÃ»u\ : Ä‘eo cÆ°á»m (háº¡t).
BuÃ´n (Ä‘gt),NuÃ´i. BuÃ´n mÃ¢o: nuÃ´i ráº¯n.
BuÃ´n ba (Ä‘t),NuÃ´i dáº¡y. BuÃ´n ba anak: NuÃ´i dáº¡y con.
BÄƒn (Ä‘t),LÃ². BÄƒh pui: LÃ² sÆ°á»Ÿi.
BÆ¡Ì† (dt),SÃ¡ng (sÃ¡ng ra). BÆ¡# aguah: SÃ¡ng sá»›m.
BlÃ¢o (Ä‘t),Nhai. BlÃ¢o hmÄƒn: nhai tráº§u.
BÆ¡Ì†ng (dt),MÃ¨o. 
BÆ¡Ì†ng (dt),ÄÃ²n gÃ¡nh.
BÆ¡Ì†t (Ä‘gt),Nháº¥n. BÆ¡#t phao: nháº¥n máº¡nh.
BÆ¡Ì†t mÄ­n (dt),Nháº­n xÃ©t.
ByÄƒn (Ä‘t),BÃ¬nh. ByÄƒn Ãªa: BÃ¬nh nÆ°á»›c. ByÄƒn kdra: BÃ¬nh trÃ .
YuÃ´m bhÄƒn (tt),1. VÃ´ giÃ¡. Klei yuÃ´m bhÄƒn: Váº­t vÃ´ giÃ¡.
,2. Trá»ng Ä‘áº¡i. Klei truh yuÃ´m bhÄƒn: Sá»± kiá»‡n trá»ng Ä‘áº¡i.
,3. Cáº§n thiáº¿t. BruÄƒ yuÃ´m bhÄƒn: Viá»‡c cáº§n thiáº¿t.
,"4. Quan trá»ng. Mne#] ngÄƒ yuÃ´m bhÄƒn: Biá»‡n phÃ¡p quan trá»ng."
,5. ThiÃªng liÃªng. 
YuÃ´m yÄ­n (tt),Äáº¯t Ä‘á». MnÆ¡\ng mnuÄƒ yuÃ´m yyÃ¸n: hÃ ng hÃ­ Ä‘áº¯t Ä‘á».
YuÃ´r (dt),CÃ¢y canh kina rá»«ng.
YuÃ´t (Ä‘gt),BÃ¡m. YuÃ´t ti dhan kyÃ¢o hrut asei Ä‘yÃ¸ kÆ¡ dlÃ´ng: BÃ¡m cÃ nh cÃ¢y Ä‘u ngÆ°á»i lÃªn.
Yut yat  (tt),Äung Ä‘Æ°a.
YÅ­ (dt),(HÆ°á»›ng) TÃ¢y. AngyÃ¸ng mÆ¡\ng yu\: GiÃ³ TÃ¢y.
YÅ­ ngÅ (dt),PhÆ°Æ¡ng hÆ°á»›ng. AmÃ¢o lo\ thÃ¢o yu\ ngo\: Láº¡c máº¥t phÆ°Æ¡ng hÆ°á»›ng.
YÅ­k (dt),"ÄÅ©ng. Yu\k ]hum: Ä‘Å©ng quáº§n."
YÅ­m (tt),MÄƒn (nhiá»u)
YÅ­n (Ä‘gt),Rung.
YÅ­ng jing (Ä‘gt),Äá»©ng sá»¯ng.
YÅ­r (dt),DÃ¡i. Yu\r knga: DÃ¡i tai.
YÅ­r tluÃ´n (dt),MÃ´ng
YÆ°h yÆ°p (tt),1. Cháº­m cháº¡p. EÃ¹bat yÆ°h yÆ°p: Ä‘i cháº­m cháº¡p.
,2. Lá»¥n báº¡i. Ai tiÃª yÆ°h yÆ°p: Cuá»™c sá»‘ng lá»¥n báº¡i.`;
        
        if (!state.isAuthReady) {
            console.warn("Authentication not ready. Cannot load initial dictionary data.");
            return;
        }

        const lines = docxContent.split('\n').map(line => line.trim()).filter(line => line.length > 0 && !line.startsWith('Tá»«,NghÄ©a') && !line.startsWith('A,') && !line.startsWith('B,'));
        const newTerms = [];
        lines.forEach(line => {
            const parts = line.split(',');
            if (parts.length >= 2) {
                const ede = parts[0].trim();
                const viet = parts.slice(1).join(',').trim();
                if (ede && viet) {
                    newTerms.push({ ede, viet });
                }
            }
        });
        
        try {
            const { collection, getDocs, addDoc } = window.firebaseModules.firestore;
            const customDictionaryRef = collection(db, `artifacts/${__app_id}/users/${state.userId}/customDictionary`);
            const existingDocsSnapshot = await getDocs(customDictionaryRef);
            const existingTerms = new Set(existingDocsSnapshot.docs.map(doc => `${doc.data().ede.toLowerCase()}|${doc.data().viet.toLowerCase()}`));

            let addedCount = 0;
            const promises = newTerms.map(async term => {
                const termKey = `${term.ede.toLowerCase()}|${term.viet.toLowerCase()}`;
                if (!existingTerms.has(termKey)) {
                    await addDoc(customDictionaryRef, { ede: term.ede, viet: term.viet, timestamp: Date.now() });
                    addedCount++;
                    existingTerms.add(termKey); // Add to local set to prevent duplicates from this batch
                }
            });

            await Promise.all(promises);
            console.log(`Successfully added ${addedCount} new terms from the file.`);
            showMessage(`ÄÃ£ thÃªm thÃ nh cÃ´ng ${addedCount} tá»« vÃ o tá»« Ä‘iá»ƒn cÃ¡ nhÃ¢n!`, 3000);
        } catch (error) {
            console.error("Error loading initial dictionary data:", error);
            showMessage(`Lá»—i khi táº£i tá»« Ä‘iá»ƒn tá»« file: ${error.message}`, 5000);
        }
    }


    async function handleAddTerm() {
        if (!state.isAuthReady) {
            showMessage("ChÆ°a sáºµn sÃ ng Ä‘á»ƒ thÃªm tá»«. Vui lÃ²ng thá»­ láº¡i sau.", 3000);
            return;
        }
        const ede = ui.newEdeText.value.trim();
        const viet = ui.newVietText.value.trim();
        if (ede && viet) {
            // Check for duplicates before adding
            const isDuplicate = state.dictionary.some(term => 
                term.ede.toLowerCase() === ede.toLowerCase() &&
                term.viet.toLowerCase() === viet.toLowerCase()
            );

            if (isDuplicate) {
                showMessage("Tá»« nÃ y Ä‘Ã£ cÃ³ trong tá»« Ä‘iá»ƒn cá»§a báº¡n.", 3000);
                return;
            }

            try {
                const { collection, addDoc } = window.firebaseModules.firestore;
                const customDictionaryRef = collection(db, `artifacts/${__app_id}/users/${state.userId}/customDictionary`);
                await addDoc(customDictionaryRef, { ede, viet, timestamp: Date.now() });
                ui.newEdeText.value = '';
                ui.newVietText.value = '';
                showMessage("ÄÃ£ thÃªm tá»« má»›i vÃ o tá»« Ä‘iá»ƒn cÃ¡ nhÃ¢n!", 2000);
            } catch (error) {
                console.error("Error adding document: ", error);
                showMessage(`Lá»—i khi thÃªm tá»«: ${error.message}`, 5000);
            }
        } else {
            showMessage("Vui lÃ²ng nháº­p cáº£ tá»« ÃŠ-Ä‘Ãª vÃ  nghÄ©a tiáº¿ng Viá»‡t.", 3000);
        }
    }

    async function handleDeleteTerm(e) {
        if (!state.isAuthReady) {
            showMessage("ChÆ°a sáºµn sÃ ng Ä‘á»ƒ xÃ³a tá»«. Vui lÃ²ng thá»­ láº¡i sau.", 3000);
            return;
        }
        if (e.target.classList.contains('delete-term-btn')) {
            const id = e.target.dataset.id;
            try {
                const { doc, deleteDoc } = window.firebaseModules.firestore;
                const termRef = doc(db, `artifacts/${__app_id}/users/${state.userId}/customDictionary`, id);
                await deleteDoc(termRef);
                showMessage("ÄÃ£ xÃ³a tá»« khá»i tá»« Ä‘iá»ƒn cÃ¡ nhÃ¢n.", 2000);
            } catch (error) {
                console.error("Error removing document: ", error);
                showMessage(`Lá»—i khi xÃ³a tá»«: ${error.message}`, 5000);
            }
        }
    }

    async function handleLoadDictionaryFromFile() {
        if (!state.isAuthReady) {
            showMessage("ChÆ°a sáºµn sÃ ng Ä‘á»ƒ táº£i tá»« Ä‘iá»ƒn. Vui lÃ²ng thá»­ láº¡i sau.", 3000);
            return;
        }
        const file = ui.loadDictionaryFileInput.files[0];
        if (!file) {
            showMessage("Vui lÃ²ng chá»n má»™t file Ä‘á»ƒ táº£i.", 3000);
            return;
        }
        
        setLoadingState(ui.loadDictionaryFromFileButton, true, 'Táº£i tá»« File');
        const fileType = file.name.split('.').pop().toLowerCase();
        
        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                let loadedData = [];
                if (fileType === 'json') {
                    loadedData = JSON.parse(e.target.result);
                    if (!Array.isArray(loadedData) || !loadedData.every(item => item.ede && item.viet)) {
                        throw new Error("Invalid JSON format. Expected an array of objects with 'ede' and 'viet' properties.");
                    }
                } else if (fileType === 'csv') {
                    const lines = e.target.result.split('\n').filter(line => line.trim() !== '');
                    if (lines[0].trim().toLowerCase() !== '"tá»« ÃŠ-Ä‘Ãª","nghÄ©a tiáº¿ng Viá»‡t"' && lines[0].trim().toLowerCase() !== 'tá»« ÃŠ-Ä‘Ãª,nghÄ©a tiáº¿ng Viá»‡t') {
                        throw new Error("Invalid CSV format. Header should be 'Tá»« ÃŠ-Ä‘Ãª,NghÄ©a tiáº¿ng Viá»‡t'.");
                    }
                    lines.slice(1).forEach(line => {
                        const [ede, viet] = line.split(/,"|",/);
                        if (ede && viet) {
                            loadedData.push({ ede: ede.replace(/"/g, '').trim(), viet: viet.replace(/"/g, '').trim() });
                        }
                    });
                } else {
                    throw new Error("Unsupported file type. Please use .json or .csv.");
                }

                const { collection, addDoc } = window.firebaseModules.firestore;
                const customDictionaryRef = collection(db, `artifacts/${__app_id}/users/${state.userId}/customDictionary`);
                let addedCount = 0;
                
                const promises = loadedData.map(async newItem => {
                    const isDuplicate = state.dictionary.some(existingItem =>
                        existingItem.ede.toLowerCase() === newItem.ede.toLowerCase() &&
                        existingItem.viet.toLowerCase() === newItem.viet.toLowerCase()
                    );
                    if (!isDuplicate) {
                        await addDoc(customDictionaryRef, { ede: newItem.ede, viet: newItem.viet, timestamp: Date.now() });
                        addedCount++;
                    }
                });

                await Promise.all(promises);
                showMessage(`ÄÃ£ táº£i thÃ nh cÃ´ng ${addedCount} tá»« vÃ o tá»« Ä‘iá»ƒn!`, 3000);

            } catch (error) {
                showMessage(`Lá»—i khi Ä‘á»c file: ${error.message}. Vui lÃ²ng Ä‘áº£m báº£o file cÃ³ Ä‘á»‹nh dáº¡ng há»£p lá»‡.`, 5000);
                console.error("Error parsing dictionary file:", error);
            } finally {
                setLoadingState(ui.loadDictionaryFromFileButton, false, 'Táº£i tá»« File');
            }
        };
        reader.onerror = () => {
            showMessage("KhÃ´ng thá»ƒ Ä‘á»c file. Vui lÃ²ng thá»­ láº¡i.", 5000);
            setLoadingState(ui.loadDictionaryFromFileButton, false, 'Táº£i tá»« File');
        };
        reader.readAsText(file);
    }
    
    // --- SPEECH & TEXT-TO-SPEECH ---
    function setupSpeechRecognition() {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            ui.recordButton.disabled = true;
            ui.recordButton.title = "TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ ghi Ã¢m giá»ng nÃ³i.";
            showMessage("TrÃ¬nh duyá»‡t cá»§a báº¡n khÃ´ng há»— trá»£ ghi Ã¢m giá»ng nÃ³i.", 5000);
            return;
        }
        state.recognition = new SpeechRecognition();
        state.recognition.continuous = false;
        state.recognition.interimResults = false;
        state.recognition.lang = 'vi-VN';

        state.recognition.onstart = () => {
            state.isRecording = true;
            ui.recordButton.querySelector('.record-icon').classList.add('recording');
            ui.recordButton.title = "Äang ghi Ã¢m...";
        };
        state.recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            ui.inputText.value = transcript;
            state.isRecording = false;
            ui.recordButton.querySelector('.record-icon').classList.remove('recording');
            ui.recordButton.title = "Ghi Ã¢m giá»ng nÃ³i";
        };
        state.recognition.onerror = (event) => {
            console.error("Speech recognition error:", event.error);
            showMessage(`Lá»—i ghi Ã¢m: ${event.error}`, 5000);
            state.isRecording = false;
            ui.recordButton.querySelector('.record-icon').classList.remove('recording');
            ui.recordButton.title = "Ghi Ã¢m giá»ng nÃ³i";
        };
        state.recognition.onend = () => {
            state.isRecording = false;
            ui.recordButton.querySelector('.record-icon').classList.remove('recording');
            ui.recordButton.title = "Ghi Ã¢m giá»ng nÃ³i";
        };
    }

    function speakText(text, lang = 'vi-VN') {
        if ('speechSynthesis' in window) {
            if (state.speechSynthesisUtterance && speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            state.speechSynthesisUtterance = new SpeechSynthesisUtterance(text);
            state.speechSynthesisUtterance.lang = lang;
            speechSynthesis.speak(state.speechSynthesisUtterance);
        } else {
            showMessage("TrÃ¬nh duyá»‡t cá»§a báº¡n khÃ´ng há»— trá»£ phÃ¡t Ã¢m vÄƒn báº£n.", 3000);
        }
    }

    // --- EVENT LISTENERS & INITIAL SETUP ---
    function setupTabs() {
        ui.tabs.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.dataset.tab;
                if (tabId === state.currentTab) return;

                ui.tabs.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                ui.tabContents.forEach(content => content.classList.add('hidden'));
                document.getElementById(tabId).classList.remove('hidden');
                
                state.currentTab = tabId;
            });
        });
    }

    function setupEventListeners() {
        ui.translateButton.addEventListener('click', handleTranslate);
        ui.generateExamplesButton.addEventListener('click', handleGenerateExamples);
        ui.summarizeExplainButton.addEventListener('click', handleSummarize);
        ui.generateParagraphButton.addEventListener('click', handleGenerateParagraph);
        ui.recordButton.addEventListener('click', () => {
            if (state.isRecording) {
                state.recognition.stop();
            } else {
                ui.inputText.value = '';
                state.recognition.start();
            }
        });
        ui.dropZone.addEventListener('click', () => ui.imageInput.click());
        ui.imageInput.addEventListener('change', (e) => handleImageSelection(e.target.files[0]));
        ui.dropZone.addEventListener('dragover', (e) => {
            e.preventDefault(); e.stopPropagation();
            ui.dropZone.classList.add('border-blue-500', 'bg-blue-50');
        });
        ui.dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault(); e.stopPropagation();
            ui.dropZone.classList.remove('border-blue-500', 'bg-blue-50');
        });
        ui.dropZone.addEventListener('drop', (e) => {
            e.preventDefault(); e.stopPropagation();
            ui.dropZone.classList.remove('border-blue-500', 'bg-blue-50');
            if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                handleImageSelection(e.dataTransfer.files[0]);
            }
        });
        ui.removeImageButton.addEventListener('click', (e) => {
            e.stopPropagation();
            state.selectedImageFile = null;
            ui.imageInput.value = '';
            ui.imagePreview.src = '';
            ui.imagePlaceholder.classList.remove('hidden');
            ui.imagePreviewWrapper.classList.add('hidden');
            ui.translateImageButton.disabled = true;
        });
        ui.translateImageButton.addEventListener('click', handleTranslateImage);
        ui.addTermButton.addEventListener('click', handleAddTerm);
        ui.customTranslationsList.addEventListener('click', handleDeleteTerm);
        ui.loadDictionaryFromFileButton.addEventListener('click', handleLoadDictionaryFromFile);
        ui.speakTranslatedTextButton.addEventListener('click', () => speakText(ui.outputText.value));
        ui.speakAdditionalTextButton.addEventListener('click', () => speakText(ui.additionalOutput.value));
        ui.speakEdeParagraphButton.addEventListener('click', () => speakText(ui.edeParagraphOutput.value, 'vi-VN')); // Assuming Vietnamese TTS can handle Ede text for now
        ui.speakVietParagraphButton.addEventListener('click', ()anto speakText(ui.vietParagraphOutput.value, 'vi-VN'));
    }

    // --- MAIN ENTRY POINT ---
    initializeFirebase();
    setupTabs();
    setupSpeechRecognition();
    setupEventListeners();
});
</script>
</body>
</html>
